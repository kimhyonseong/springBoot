<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>food insert</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        * {
            padding: 0;
            margin: 0;
        }
        .preImage {
            max-width: 200px;
        }
    </style>
</head>
<body>
<div class="wrap">
    <form method="post" enctype="multipart/form-data">
        <div>
            <label for="itemName">아이템 이름</label>
            <p th:text="${valid_name}" style="height: max-content"></p>
            <input type="text" id="itemName" name="name" th:value="${name}">
        </div>
        <div>
            <label for="itemCode">아이템 분류</label>
            <p th:text="${valid_code}"></p>
            <input type="text" id="itemCode" name="code" th:value="${code}">
        </div>
        <div>
            <label for="itemDesc">아이템 설명</label>
            <p th:text="${valid_description}"></p>
            <input type="text" id="itemDesc" name="description" th:value="${description}">
        </div>
        <div>
            <label for="itemPrice">아이템 가격</label>
            <p th:text="${valid_price}"></p>
            <input type="text" id="itemPrice" name="price" th:value="${price}">
        </div>
        <div>
            <label for="itemQuantity">아이템 수량</label>
            <p th:text="${valid_quantity}"></p>
            <input type="text" id="itemQuantity" name="quantity" th:value="${quantity}">
        </div>
        <div style="margin: 20px;
                    display: flex;
                    flex-direction: column;
                    flex-wrap: wrap;
                    align-items: baseline;">
            <p>아이템 사진</p>
            <div style="display: flex;
                        flex-direction: column;">
                <label th:for="itemImg" th:text="${img?.originName ?: '이미지'}"></label>
                <input style="display: none" type="file" th:id="itemImg">
                <input type="hidden" name="originName" th:id="originName" th:value="${img?.originName}">
                <input type="hidden" name="imgUrl" th:id="imgUrl" th:value="${img?.imgUrl}">
                <img class="preImage" th:id="itemImgPre" th:src="${img?.src ?: 'https://via.placeholder.com/150'}" alt="img">
            </div>
        </div>
        <input type="submit">
    </form>
</div>
<script>
    $(function () {
        $("input[type=file]").on("change", function () {
            upload($(this)[0]);
        })
    })

    function upload(target) {
        const image = target;
        const formData = new FormData();
        formData.append("image",image.files[0]);

        $.ajax({
            url:"/admin/imgUpload",
            type:"POST",
            processData: false,
            contentType: false,
            data : formData,
            success : function (data) {
                //console.log(data);
                $(`#${target.id}Pre`).attr("src",`/images/tmp/${data.newName}`);
                $(target).val("");
                $("#imgUrl").val(`${data.newName}`);
                $("#originName").val(`${data.originName}`);
            }
        })
    }
</script>
</body>
</html>